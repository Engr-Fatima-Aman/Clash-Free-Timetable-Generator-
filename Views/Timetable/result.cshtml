@using System.Linq
@model IEnumerable<IGrouping<dynamic, dsa_project.Models.TimetableAssignment>>

<style>
    .timetable-container { margin-top: 30px; font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; }
    .class-header { background-color: #2c3e50; color: white; padding: 15px; border-radius: 8px 8px 0 0; margin-top: 20px; }
    .table-custom { border: 2px solid #2c3e50; margin-bottom: 50px; box-shadow: 0 4px 6px rgba(0,0,0,0.1); }
    .badge-lab { background-color: #e74c3c; color: white; }
    .badge-room { background-color: #95a5a6; color: white; }
    
    @@media print {
        .no-print { display: none !important; }
        .page-break { page-break-before: always; }
        .timetable-container { width: 100%; margin: 0; }
    }
</style>

<div class="container timetable-container">
    <div class="d-flex justify-content-between align-items-center mb-4 no-print">
        <h2 class="text-primary fw-bold">Academic Timetable</h2>
        <button onclick="window.print()" class="btn btn-success px-4">Print All Sections</button>
    </div>

    @{ int sectionIdx = 0; }
    @foreach (var classGroup in Model)
    {
        <div class="@(sectionIdx > 0 ? "page-break" : "")">
        @{ sectionIdx++; }
        
        <div class="class-header">
            @* Update: Ab sirf ClassName dikhayega kyunke usme Semester-Section (1-A) dono hain *@
            <h4 class="mb-0">Class: @classGroup.Key.ClassName</h4>
        </div>
        
        <table class="table table-bordered table-hover text-center table-custom bg-white">
            @* ... (thead same rahega) ... *@
            <tbody>
                @* Update: Sorting logic mein thora behtar order taake time wise bhi sort ho *@
                @foreach (var item in classGroup.OrderBy(x => GetDayOrder(x.TimeSlotInfo)).ThenBy(x => x.TimeSlotId))
                {
                    @* Highlight Lab Rows: Poori row ka background halka sa change karne ke liye *@
                    <tr class="@(item.CourseName.ToLower().Contains("lab") ? "table-light" : "")">
                        <td class="fw-bold">@item.TimeSlotInfo</td>
                        <td>@item.CourseName</td>
                        <td>@item.TeacherName</td>
                        <td>
                            <span class="badge @(item.RoomName.ToLower().Contains("lab") ? "badge-lab" : "badge-room") p-2">
                                @item.RoomName
                            </span>
                        </td>
                    </tr>
                }
            </tbody>
        </table>
    </div>
}
    }
</div>

@functions {
    private int GetDayOrder(string info) {
        if (info.Contains("Monday")) return 1;
        if (info.Contains("Tuesday")) return 2;
        if (info.Contains("Wednesday")) return 3;
        if (info.Contains("Thursday")) return 4;
        if (info.Contains("Friday")) return 5;
        return 6;
    }
}