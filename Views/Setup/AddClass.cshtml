@model dsa_project.Models.Class

@{
    ViewData["Title"] = "Add Class Section";
}

<link rel="stylesheet" href="~/css/main.css">
<link rel="stylesheet" href="~/css/components.css">
<link rel="stylesheet" href="~/css/forms.css">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

<div class="form-section">
    <div class="container">
        <div class="form-container">
            <!-- Form Steps -->
            <div class="form-steps mb-4">
                <div class="form-step">
                    <div class="step-number active">1</div>
                    <div class="step-label">Basic Info</div>
                </div>
                <div class="form-step">
                    <div class="step-number">2</div>
                    <div class="step-label">Course Selection</div>
                </div>
                <div class="form-step">
                    <div class="step-number">3</div>
                    <div class="step-label">Review & Save</div>
                </div>
            </div>

            <!-- Main Form Card -->
            <div class="form-card">
                <div class="form-header">
                    <h1 class="form-title">
                        <i class="fas fa-users"></i>
                        Add New Class Section
                    </h1>
                </div>

                <div class="form-body">
                    @if (ViewBag.Message != null)
                    {
                        <div class="form-alert">
                            <i class="fas fa-check-circle"></i>
                            @ViewBag.Message
                            <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close" style="float: right;"></button>
                        </div>
                    }

                    <form asp-action="AddClass" method="post" id="classForm">
                        <div class="form-grid">
                            <!-- Department/Class Name -->
                            <div class="mb-3">
                                <label class="form-label">
                                    <i class="fas fa-university"></i>
                                    Department / Class Name
                                </label>
                                <input name="Name" class="form-control form-control-lg" 
                                       placeholder="e.g. BSCS, BBA, BEE" 
                                       required 
                                       oninput="updatePreview()" />
                                <div class="form-hint">
                                    <i class="fas fa-info-circle"></i>
                                    Enter the base name of the degree program
                                </div>
                            </div>

                            <!-- Semester -->
                            <div class="mb-3">
                                <label class="form-label">
                                    <i class="fas fa-calendar-alt"></i>
                                    Semester
                                </label>
                                <select name="Semester" class="form-select form-control-lg" onchange="updatePreview()">
                                    @for (int i = 1; i <= 8; i++)
                                    {
                                        <option value="@i">Semester @i</option>
                                    }
                                </select>
                            </div>

                            <!-- Section -->
                            <div class="mb-3">
                                <label class="form-label">
                                    <i class="fas fa-layer-group"></i>
                                    Section
                                </label>
                                <select name="Section" class="form-select form-control-lg" onchange="updatePreview()">
                                    <option value="A">Section A</option>
                                    <option value="B">Section B</option>
                                    <option value="C">Section C</option>
                                    <option value="D">Section D</option>
                                </select>
                            </div>

                            <!-- Total Students -->
                            <div class="mb-3">
                                <label class="form-label">
                                    <i class="fas fa-user-graduate"></i>
                                    Total Students
                                </label>
                                <input name="TotalStudents" type="number" 
                                       class="form-control form-control-lg" 
                                       placeholder="e.g. 50" 
                                       required 
                                       min="1" 
                                       max="200"
                                       oninput="updatePreview()" />
                                <div class="form-hint">
                                    <i class="fas fa-users"></i>
                                    Number of students in this section
                                </div>
                            </div>
                        </div>

                        <!-- Course IDs -->
                        <div class="mb-4">
                            <label class="form-label">
                                <i class="fas fa-book"></i>
                                Course Assignments
                            </label>
                            <div class="course-id-input">
                                <input name="courseIdsInput" 
                                       class="form-control form-control-lg" 
                                       placeholder="Enter course IDs separated by commas or semicolons (e.g. 1, 2, 5)" 
                                       required 
                                       id="courseIdsInput" />
                                <div class="form-hint">
                                    <i class="fas fa-lightbulb"></i>
                                    Check 'Manage Data' to see available Course IDs
                                </div>
                                
                                <!-- Course ID Tags Display -->
                                <div class="course-tags" id="courseTags">
                                    <!-- Tags will be added here by JavaScript -->
                                </div>
                                
                                <!-- Course Suggestions (would be populated from backend in real app) -->
                                <div class="course-suggestions" id="courseSuggestions">
                                    <!-- Suggestions would be loaded dynamically -->
                                </div>
                            </div>
                        </div>

                        <!-- Form Actions -->
                        <div class="form-actions">
                            <button type="submit" class="btn-submit">
                                <i class="fas fa-save"></i>
                                Save Class Section
                            </button>
                            <a href="/Timetable/Index" class="btn-back">
                                <i class="fas fa-arrow-left"></i>
                                Back to Dashboard
                            </a>
                        </div>
                    </form>
                </div>
            </div>

            <!-- Help Section -->
            <div class="card mt-4" style="border: 1px solid #e2e8f0; border-radius: 12px;">
                <div class="card-body">
                    <h5 class="card-title" style="color: #2c3e50;">
                        <i class="fas fa-question-circle text-primary me-2"></i>
                        How to Add a Class Section
                    </h5>
                    <ul class="list-unstyled mb-0">
                        <li class="mb-2">
                            <i class="fas fa-check-circle text-success me-2"></i>
                            <strong>Class Name:</strong> Use the base degree name (e.g., BSCS for Computer Science)
                        </li>
                        <li class="mb-2">
                            <i class="fas fa-check-circle text-success me-2"></i>
                            <strong>Course IDs:</strong> Add IDs from existing courses. Separate multiple IDs with commas
                        </li>
                        <li class="mb-2">
                            <i class="fas fa-check-circle text-success me-2"></i>
                            <strong>Section:</strong> Different sections can have different timetables
                        </li>
                        <li>
                            <i class="fas fa-check-circle text-success me-2"></i>
                            <strong>Student Count:</strong> Used for room capacity calculations
                        </li>
                    </ul>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
    document.addEventListener('DOMContentLoaded', function() {
        // Initialize course ID tags
        const courseIdsInput = document.getElementById('courseIdsInput');
        const courseTags = document.getElementById('courseTags');
        
        // Parse and display course IDs as tags
        function updateCourseTags() {
            const input = courseIdsInput.value;
            const courseIds = input.split(/[,;]\s*/).filter(id => id.trim() !== '');
            
            courseTags.innerHTML = '';
            courseIds.forEach(id => {
                const tag = document.createElement('span');
                tag.className = 'course-tag';
                tag.innerHTML = `<i class="fas fa-hashtag"></i>${id.trim()}`;
                courseTags.appendChild(tag);
            });
            
            // Update preview
            updatePreview();
        }
        
        courseIdsInput.addEventListener('input', updateCourseTags);
        
        // Update preview on form changes
        function updatePreview() {
            const nameInput = document.querySelector('input[name="Name"]');
            const semesterSelect = document.querySelector('select[name="Semester"]');
            const sectionSelect = document.querySelector('select[name="Section"]');
            const studentsInput = document.querySelector('input[name="TotalStudents"]');
            const coursesInput = document.getElementById('courseIdsInput');
            
            // Update preview values
            document.getElementById('previewName').textContent = nameInput.value || '-';
            document.getElementById('previewSemester').textContent = semesterSelect ? 'Semester ' + semesterSelect.value : '-';
            document.getElementById('previewSection').textContent = sectionSelect ? 'Section ' + sectionSelect.value : '-';
            document.getElementById('previewStudents').textContent = studentsInput.value ? studentsInput.value + ' students' : '-';
            
            // Parse course IDs for preview
            if (coursesInput.value) {
                const courseIds = coursesInput.value.split(/[,;]\s*/)
                    .filter(id => id.trim() !== '')
                    .map(id => '#' + id.trim())
                    .join(', ');
                document.getElementById('previewCourses').textContent = courseIds || '-';
            } else {
                document.getElementById('previewCourses').textContent = '-';
            }
        }
        
        // Initialize preview
        updatePreview();
        
        // Form validation
        const form = document.getElementById('classForm');
        form.addEventListener('submit', function(e) {
            const name = document.querySelector('input[name="Name"]').value;
            const students = document.querySelector('input[name="TotalStudents"]').value;
            const courseIds = document.getElementById('courseIdsInput').value;
            
            // Basic validation
            if (!name || !students || !courseIds) {
                e.preventDefault();
                alert('Please fill in all required fields.');
                return false;
            }
            
            // Validate student count
            const studentCount = parseInt(students);
            if (studentCount < 1 || studentCount > 200) {
                e.preventDefault();
                alert('Please enter a valid number of students (1-200).');
                return false;
            }
            
            // Validate course IDs format
            const courseIdArray = courseIds.split(/[,;]\s*/).filter(id => id.trim() !== '');
            const invalidIds = courseIdArray.filter(id => isNaN(id) || id.trim() === '');
            if (invalidIds.length > 0) {
                e.preventDefault();
                alert('Please enter valid numeric course IDs.');
                return false;
            }
            
            return true;
        });
        
        // Add input focus styles
        const inputs = document.querySelectorAll('.form-control, .form-select');
        inputs.forEach(input => {
            input.addEventListener('focus', function() {
                this.parentElement.style.transform = 'translateY(-2px)';
            });
            
            input.addEventListener('blur', function() {
                this.parentElement.style.transform = 'translateY(0)';
            });
        });
    });
</script>